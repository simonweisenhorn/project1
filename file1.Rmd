---
title: "file1"
author: "Simon Weisenhorn"
date: "2023-06-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(httr) #Here I am loading the required library for the following steps
library(tidyverse)

```

```{r}
library(stringr)
#str_to_title()
```


```{r echo=TRUE}
fooddata = GET("http://www.omdbapi.com/?y=2023&apikey=5ac618d8")
fooddata = GET("https://api.spoonacular.com/recipes/complexSearch?cuisine=italian&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b")
#Here I am using the GET function from the httr package to return information 
#about every news story about Apple in the last month sorted by most recent 
#first in hopes of seeing information about the new vision pro goggles that
#they released today
```

### Number 2

```{r echo=TRUE}
str(fooddata, max.level = 1) #viewing the structure of the newsdata
```

```{r echo=TRUE, message=FALSE}
library(jsonlite) #loading the required library for the following steps
parsed <- fromJSON(rawToChar(fooddata$content))
#Here I am using the fromJSON function to grab the list element we want, convert 
#it to characters, and convert it to a data frame
str(parsed, max.level = 1) #viewing structure of parsed
```


```{r echo=TRUE}
parsed$results %>%colnames()#Viewing available colnames
articleInfo <- parsed$results #saving the article information into an object
as_tibble(articleInfo[,c("id", "title")])
#here I am printing the tibble out and only showing the source author, and 
#title columns
```

```{r}
food = function(cuisine) {
  cuisine = tolower(cuisine)
  jobsearch <- GET(paste("https://api.spoonacular.com/recipes/complexSearch?cuisine=",cuisine,"&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  parsed <- fromJSON(rawToChar(jobsearch$content))
  articleInfo <- parsed$results #saving the article information into an object
  return(as_tibble(articleInfo[,c("id", "title")]))
}
```


```{r}
food("american")
```


```{r}
food = function(cuisine) {
  cuisine = tolower(cuisine)
  jobsearch <- GET("https://api.spoonacular.com/recipes/715495/information?includeNutrition=TRUE&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b")
  parsed <- fromJSON(rawToChar(jobsearch$content))
  articleInfo <- parsed$results #saving the article information into an object
  return(articleInfo)
  return(as_tibble(articleInfo[,c("id", "title")]))
}
```

```{r}
 jobsearch <- GET("https://api.spoonacular.com/recipes/716429/information?includeNutrition=true&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b")
  parsed <- fromJSON(rawToChar(jobsearch$content))
  dataframe = as.data.frame(parsed$nutrition[1])
  dataframe
```

```{r}
pivot_wider(dataframe[1:2], names_from=nutrients.name, values_from=nutrients.amount)
```








jobsearch <- GET("https://api.spoonacular.com/recipes/716429/information?includeNutrition=true&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b")
  parsed <- fromJSON(rawToChar(jobsearch$content))
  dataframe = as.data.frame(parsed$nutrition[1])
  dataframe






# First Function

```{r}
recipesByCuisine = function(likedCuisine, dislikedCuisine=NULL) {
  likedCuisine = tolower(likedCuisine)
  dislikedCuisine = tolower(dislikedCuisine)
  likedCuisine = paste(likedCuisine, collapse=',')
  dislikedCuisine = paste(dislikedCuisine, collapse=',')
  if(length(dislikedCuisine)>0){
    recipes <- GET(paste("https://api.spoonacular.com/recipes/complexSearch?cuisine=",likedCuisine,"&excludeCuisine=",dislikedCuisine,"&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  } else {
    recipes <- GET(paste("https://api.spoonacular.com/recipes/complexSearch?cuisine=",likedCuisine,"&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  }
  parsed <- fromJSON(rawToChar(recipes$content))
  recipeInfo <- parsed$results 
  data = as_tibble(recipeInfo[,c("id", "title")])
  data = data %>% rename(ID = id, Recipe = title)
  return(data)
}
```

```{r}
recipesByCuisine(c("American", "Italian"))
```

# Second Function

```{r}
recipesByDiet = function(diet) {
  diet = tolower(diet)
  diet = paste(diet, collapse=',')
  recipes <- GET(paste("https://api.spoonacular.com/recipes/complexSearch?diet=",diet,"&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  parsed <- fromJSON(rawToChar(recipes$content))
  recipeInfo <- parsed$results 
  data = as_tibble(recipeInfo[,c("id", "title")])
  data = data %>% rename(ID = id, Recipe = title)
  return(data)
}
```

```{r}
recipesByDiet("Vegetarian")
```



# Third Function

```{r}
recipesByIntolerances = function(intolerance) {
  intolerance = tolower(intolerance)
  intolerance = paste(intolerance, collapse=',')
  recipes <- GET(paste("https://api.spoonacular.com/recipes/complexSearch?intolerances=",intolerance,"&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  parsed <- fromJSON(rawToChar(recipes$content))
  recipeInfo <- parsed$results 
  data = as_tibble(recipeInfo[,c("id", "title")])
  data = data %>% rename(ID = id, Recipe = title)
  return(data)
}
```

```{r}
recipesByIntolerances(c("Gluten", "Dairy", "wheat", "soy", "peanut"))
```


# Fourth Function

```{r}
recipesByIngredients = function(ingredients) {
  ingredients = tolower(ingredients)
  ingredients = paste(ingredients, collapse=',')
  recipes <- GET(paste("https://api.spoonacular.com/recipes/complexSearch?includeIngredients=",ingredients,"&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  parsed <- fromJSON(rawToChar(recipes$content))
  recipeInfo <- parsed$results 
  data = as_tibble(recipeInfo[,c("id", "title")])
  data = data %>% rename(ID = id, Recipe = title)
  return(data)
}
```

```{r}
recipesByIngredients(c("egg","bacon"))
```


# Fifth Function

```{r}
recipesByType = function(type, number=10) {
  type = tolower(type)
  type = paste(type, collapse=',')
  type = sub(" ", "_", type)
  recipes <- GET(paste("https://api.spoonacular.com/recipes/complexSearch?type=",type,"&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  parsed <- fromJSON(rawToChar(recipes$content))
  recipeInfo <- parsed$results 
  data = as_tibble(recipeInfo[,c("id", "title")])
  data = data %>% rename(ID = id, Recipe = title)
  return(data)
}
```

```{r}
recipesByType("main course")
```


# Sixth Function

```{r}
ingredientsList = function(id) {
  recipes <- GET(paste("https://api.spoonacular.com/recipes/",id,"/ingredientWidget.json?apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  parsed <- fromJSON(rawToChar(recipes$content))
  names = parsed$ingredients$name
  values = parsed$ingredients$amount$us$value
  units = parsed$ingredients$amount$us$unit
  data = data.frame(Measurements=values, Units = units, Ingredients = names)
  return(data)
}
```

```{r}
ingredientsList(782585)
```



```{r}
recipes <- GET("https://api.spoonacular.com/recipes/782601/ingredientWidget.json?apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b")
  parsed <- fromJSON(rawToChar(recipes$content))
  names = parsed$ingredients$name
  values = parsed$ingredients$amount$us$value
  units = parsed$ingredients$amount$us$unit
  data = data.frame(Measurements=values, Units = units, Ingredients = names)
  data
```


```{r}
recipeInstructions = function(id) {
  GET(paste("https://api.spoonacular.com/recipes/",id,"/analyzedInstructions?apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  parsed <- fromJSON(rawToChar(recipes$content))
  stepnum = parsed$steps[[1]]$number
  instruction = parsed$steps[[1]]$step
  data = data.frame(Step=stepnum, Instructions = instruction)
  return(data)
}
```

```{r}
recipeInstructions(782602)
```


```{r}
recipes <- GET("https://api.spoonacular.com/recipes/782601/analyzedInstructions?apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b")
  parsed <- fromJSON(rawToChar(recipes$content))
  stepnum = parsed$steps[[1]]$number
  instruction = parsed$steps[[1]]$step
  data = data.frame(Step=stepnum, Instructions = instruction)
  data
```

















# Fourth Function

```{r}
getNutrientsPerServing = function(id, type=NULL) {
  info = GET(paste0("https://api.spoonacular.com/recipes/",id,"/information?includeNutrition=true&apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b",sep=""))
  parsed <- fromJSON(rawToChar(info$content))
  dataframe = as.data.frame(parsed$nutrition[1])
  dataframe = pivot_wider(dataframe[1:2], names_from=nutrients.name, values_from=nutrients.amount)
  dataframe = dataframe %>% mutate(ID=id) %>% select(ID, everything())
  if (length(type)>0) {
    type = unlist(lapply(type, str_to_title))
    return(dataframe[c("ID",type)])
  } else{
    return(dataframe)
  }
}
```

```{r}
getNutrientsPerServing(715424)
```

# Fifth Function

```{r}
multipleNutrients = function(foodids, type=NULL) {
  data = data.frame()
  for(i in 1:length(foodids)) {
    for(j in foodids[i]){
      data = bind_rows(data, getNutrientsPerServing(j, type=type))
    }
  }
  return(data)
}
```

```{r}
multipleNutrients(foodids=c(715424,639392))
```




```{r}
equipment = function(id) {
  GET(paste("https://api.spoonacular.com/recipes/",id,"/equipmentWidget.json?apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  parsed <- fromJSON(rawToChar(recipes$content))
  equipment = parsed[[1]]$name
  data = data.frame(Equipment = equipment)
  return(data)
}
```

```{r}
equipment(1003464)
```


```{r}
recipes <- GET("https://api.spoonacular.com/recipes/1003464/equipmentWidget.json?apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b")
  parsed <- fromJSON(rawToChar(recipes$content))
  equipment = parsed[[1]]$name
  data = data.frame(Equipment = equipment)
  data
```





```{r}
recipes <- GET("https://api.spoonacular.com/recipes/69095/tasteWidget.json?apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b")
  parsed <- fromJSON(rawToChar(recipes$content))
  data.frame(parsed)
```


```{r}
GET("https://api.spoonacular.com/recipes/",id,"/equipmentWidget.json?apiKey=f8ceed6cf4f74d56b1584d84ee70ec9b", sep=""))
  parsed <- fromJSON(rawToChar(recipes$content))
  equipment = parsed[[1]]$name
  data = data.frame(Equipment = equipment)
  return(data)
```

